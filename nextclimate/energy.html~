<!DOCTYPE html>

<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
	<meta charset="utf-8">
	<title>Our shared climate future</title>
	<meta name="description" content="">
	<meta name="author" content="">
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- javascript
  ================================================== -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/raphael.js"></script>
    <script type="text/javascript" src="javascripts/jquery.enumerable.js"></script>


	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="stylesheets/base.css">
	<link rel="stylesheet" href="stylesheets/skeleton.css">
	<link rel="stylesheet" href="stylesheets/layout.css">

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

	<style type="text/css">
	  div.ex
	  {
	  width:320px;
	  padding:0px;
	  margin:10px;
	  }
	</style>

	<style type="text/css">
	  div.topfirst
	  {
	  width:320px;
	  padding:0px;
	  margin:1px;
	  background-color:"black";
	  background-image:url('');
	  }
	</style>
	<style type="text/css">
	  div.toprest
	  {
	  width:320px;
	  padding:0px;
	  margin:1px;
	  }
	  p { color:"white";  background-color:"black";}
	  a {link:text-decoration:none;}
	</style>





<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29277261-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1.1', {packages: ['corechart', 'table']});
    </script>
    <script type="text/javascript">
      function drawVisualization() {
        // Prepare the data
        var data = google.visualization.arrayToDataTable([
        ['Action','heating and cooling','water','lighting','appliances','savings', 'Act!'],
        ['No action',            1,   1,    1,   1, ' ', ' '],
        ['Solar photovoltaics', 0.15, 0.15, 0.15, 0.15, ' $$$',' '],
        ['Solar water heater',   1, 0.1,    1,   1, ' $$', ' '],
        ['Efficient lighting',   1,   1, 0.15,   1, '$', ' '],
        ['Fix air leaks',      0.9,   1,    1,   1, '$', ' '],
        ['Unplug electronics' ,  1,   1,    1, 0.7, '$', ' '],
        ['Average in your area', 6,   2,    1,    1, 'NA', 'NA'],
        ['Your baseline',          1,   1,  1,  1, 'NA', 'NA']
      ]);

      
      var i = 0;
       for (i = 1; i <= data.getNumberOfRows()-3; i = i+1) {
	 data.setCell(i,6,"<form action='/selectAct' method='get'><button type='submit' name='type' value='"+ data.getValue(i,0) +"'>Start Now!</button></form>");
	}

       for (i = 1; i <= 4; i = i+1) {
	data.setCell(data.getNumberOfRows()-1,i,
		     data.getValue(data.getNumberOfRows()-2,i) * {{elecMod}});
	}

       for (i = 1; i <= 4; i = i+1) {
	data.setCell(0,i,
		     data.getValue(data.getNumberOfRows()-2,i) * {{elecMod}});
	}


      var viewTable = new google.visualization.DataView(data);
      viewTable.hideColumns([1,2,3,4]);
      viewTable.hideRows([6,7]);

      var viewBar = new google.visualization.DataView(data);
      viewBar.hideColumns([5,6]);
      viewBar.setRows([6,7,0]);

      var options = {isStacked:true, height: 420,width:450,fontName:'Georgia',
                     legend: {position:'bottom'},
                     colors: ['#BB1111','#CC4444','#DD8888','#CCBBBB'],
                     title:'  Your Greenhouse Gas Emissions',titlePosition:'out',
                     titleTextStyle: {fontName:'Georgia',fontSize: 16},
                     hAxis:{textStyle: {fontSize: 16}},
                     chartArea:{left:20,top:20,width:"80%",height:"75%"},
                     vAxis: {minValue:0, maxValue:16, textPosition:'in', gridlines: {count:4,color:'#F8F8F8' }}
                    };

      var barchart = new google.visualization.ColumnChart(document.getElementById('chart1'));
      barchart.draw(viewBar, options);

      var table = new google.visualization.Table(document.getElementById('chart2'));
      table.draw(viewTable, {width:280, allowHtml:true});
      table.setSelection([{'row': 0}]);

      // When the table is selected, update the barchart.
      google.visualization.events.addListener(table, 'select', function() {

       var curRow = table.getSelection();
       var item = curRow[0];
       var nCurRow = item.row;

       if (nCurRow == 0) {
	data.setCell(0,0, 'No Action');
	data.setCell(0,1, 1);		
	data.setCell(0,2, 1);		
	data.setCell(0,3, 1);		
	data.setCell(0,4, 1);		
       } else {
          data.setCell(0,0,data.getValue(nCurRow,0));       
       }
       for (i = 1; i <= 4; i = i+1) {
	data.setCell(0,i,
		     data.getValue(data.getNumberOfRows()-2,i) * {{elecMod}} *
		     data.getValue(nCurRow,i));
	}
      
       viewBar.setRows([6,7,0]);
       barchart.draw(viewBar, options);

       var total = 0;
       var i = 0;

       for (i = 1; i <= 4; i = i+1) {
	total = total + data.getValue(0, i);
	}
	var totalLbs = total/2;
       document.getElementById('totalOffset').innerHTML = 
	"<p>Learn about how to <a href='http://store.terrapass.com/store/p/56-TerraPass-carbon-offsets-1-000lbs.html?qty="+totalLbs.toFixed()+"'>offset</a> the remaining "+total.toFixed()+" metric tons of greenhouse gases.</p>";
      });


      }
      

      google.setOnLoadCallback(drawVisualization);
    </script>
  </head>


<body>
    <div id="fb-root"></div>
    <script>
      // Load the SDK Asynchronously
      (function(d){
         var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement('script'); js.id = id; js.async = true;
         js.src = "//connect.facebook.net/en_US/all.js";
         ref.parentNode.insertBefore(js, ref);
       }(document));

      // Init the SDK upon load
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '179716018816396', // App ID
          channelUrl : '//'+window.location.hostname+'/fbjs', // Path to your Channel File
          status     : true, // check login status
          cookie     : true, // enable cookies to allow the server to access the session
          xfbml      : true  // parse XFBML
        });
      
      FB.getLoginStatus(function(response) {
        if (response.status === 'connected') {
         // the user is logged in and has authenticated your
         // app, and response.authResponse supplies
         // the user's ID, a valid access token, a signed
         // request, and the time the access token 
         // and signed request each expire
          var uid = response.authResponse.userID;
          var accessToken = response.authResponse.accessToken;
          FB.api('/me', function(me){
            if (me.name) {
              document.getElementById('auth-displayname').innerHTML = me.name;
            }
          })
        } else {
         // the user isn't logged in to Facebook.
          window.top.location='http://www.nextclimate.org/';          
        }
      }, true);




        // listen for and handle auth.statusChange events
        FB.Event.subscribe('auth.statusChange', function(response) {
          if (response.authResponse) {
            // user has auth'd your app and is logged into Facebook
            FB.api('/me', function(me){
              if (me.name) {
                document.getElementById('auth-displayname').innerHTML = me.name;
              }
            })
            document.getElementById('auth-loggedout').style.display = 'none';
            document.getElementById('auth-loggedin').style.display = 'block';
          } else {
            // user has not auth'd your app, or is not logged into Facebook
            window.top.location='http://www.nextclimate.org/';
            document.getElementById('auth-loggedout').style.display = 'block';
            document.getElementById('auth-loggedin').style.display = 'none';
          }
        });

        // respond to clicks on the login and logout links
        document.getElementById('auth-loginlink').addEventListener('click', function(){
          FB.login();
        });
        document.getElementById('auth-logoutlink').addEventListener('click', function(){
          FB.logout();
        }); 

      }
      
    </script>


  <div class="container">

    <div class="row sixteen columns">
      <header>
	<div class="six columns">
	  <a href="../" ><img class="logo scale-with-grid" src="../images/nextclimate_logo_transparent.png" /></a>
	</div>
	<div class="eight columns">
      	<ul>
      	  <li class='s2'><a href='static/about.html'>About</a> </li>
      	  <!-- <li class='s2'><a href='static/science.html'>Science</a> </li> -->
      	  <!-- <li class='s2'><a href='static/share.html'>Share</a> </li> -->
      	  <li class='s2'><a href='static/donate.html'>Support</a></li>
      	  <li class='s3'><a href='#' onclick='FB.logout()'>Logout (<span id="auth-displayname"></span>)</a></li>	  
      	</ul>
	</div>
      </header>
      </div>
      
    <div class="sixteen columns">
<!--       <h1 class="remove-bottom" style="margin-top: 40px">Our shared climate future</h1> -->
      <div class="fourteen columns">
	<h2>Act Now!</h2>
       <h4>Take advantage of these energy-saving
	 opportunities. You can both save money and help protect
	 future generations from dangerous climate change. Here are
	 some suggestions.</h4>
       <br> 
      </div>

      <br>
      <div class="row">
	<div class="five columns">
	 <p>Select the action below and check the improvement in
	 greenhouse gas emissions.</p>
         <div style="float: rigth;" id="chart2"></div>
	 <br>
	 <div id="totalOffset"></div>
	</div>
	<div class="nine columns">
            <div style="float: right;" id="chart1"></div>
	</div>

      </div>
      </div>
      </div>
  </body>
</html>
